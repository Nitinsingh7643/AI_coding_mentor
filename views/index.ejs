<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Coding Mentor - Premium</title>

  <!-- Fonts: Inter for UI, Fira Code for Code -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Highlight.js Theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

  <!-- Custom CSS -->
  <link href="/styles.css" rel="stylesheet" />
</head>

<body>
  <div class="app-container">

    <!-- 1. Sidebar -->
    <aside class="sidebar">
      <div class="brand-section">
        <div class="brand">
          <img src="/logo.png" alt="AI" class="logo-img"> <!-- Ensure logo.png exists or use text -->
          <h1>AI.Mentor</h1>
        </div>
      </div>

      <nav class="nav-menu">
        <a href="/app" class="nav-item active">
          <span>ğŸš€</span> Editor
        </a>
        <a href="#" class="nav-item">
          <span>ğŸ“š</span> History
        </a>
        <a href="#" class="nav-item">
          <span>ğŸ§©</span> Templates
        </a>
        <a href="/dashboard" class="nav-item">
          <span>ğŸ“Š</span> Analytics
        </a>
        <a href="#" class="nav-item">
          <span>âš™ï¸</span> Settings
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="nav-item">
          <span>ğŸ’</span> Go Pro
        </div>
      </div>
    </aside>

    <!-- 2. Main Content -->
    <main class="main-content">

      <!-- Sticky Header -->
      <header class="top-bar">
        <div class="project-info">
          <span style="color:var(--text-secondary);">Project /</span>
          <span style="font-weight:600; color:var(--text-primary);">Untitled-Snippet</span>
          <% if(language) { %>
            <span class="badge">
              <%= language %>
            </span>
            <% } %>
        </div>

        <div class="top-controls">
          <button class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Toggle Theme">
            ğŸŒ™
          </button>
          <button class="secondary-btn" style="padding: 8px 16px; border-radius: 6px;">Share</button>
          <div class="profile-avatar" style="width:32px; height:32px; background:#3b82f6; border-radius:50%;"></div>
        </div>
      </header>

      <!-- Split Screen Editor -->
      <div class="editor-layout">

        <!-- Left Panel: Code Input -->
        <section class="panel left-panel">
          <form action="/" method="POST" style="display:flex; flex-direction:column; height:100%;">
            <div class="toolbar">
              <span class="toolbar-title">Code Input</span>

              <!-- Mode Toggle Buttons -->
              <div class="mode-toggles">
                <input type="hidden" name="mode" id="mode-input" value="<%= mode %>">

                <button type="button" class="mode-btn <%= mode === 'improve' ? 'active' : '' %>"
                  onclick="setMode('improve')">âœ¨ Improve</button>
                <button type="button" class="mode-btn <%= mode === 'explain' ? 'active' : '' %>"
                  onclick="setMode('explain')">ğŸ’¡ Explain</button>
                <button type="button" class="mode-btn <%= mode === 'comment' ? 'active' : '' %>"
                  onclick="setMode('comment')">ğŸ“ Comment</button>
                <button type="button" class="mode-btn <%= mode === 'debug' ? 'active' : '' %>"
                  onclick="setMode('debug')">ğŸ Debug</button>
              </div>
            </div>

            <div class="editor-container">
              <textarea name="code" id="code" placeholder="// Paste your code here..."
                spellcheck="false"><%= code %></textarea>

              <!-- Floating Actions -->
              <div class="editor-actions">
                <button type="button" onclick="startVoiceInput()"
                  class="secondary-btn action-btn voice-btn">ğŸ™ï¸</button>
                <button type="button" onclick="clearEditor()" class="secondary-btn action-btn">ğŸ—‘ï¸</button>
                <button type="submit" class="action-btn">
                  <span>âœ¨</span> Generate
                </button>
              </div>
            </div>
          </form>
        </section>

        <!-- Right Panel: AI Result -->
        <section class="panel right-panel">
          <div class="toolbar">
            <span class="toolbar-title">AI Insights</span>
            <div style="display:flex; gap:8px; align-items:center;">
              <!-- Complexity Badges Container -->
              <div id="complexity-badges" style="display:flex; gap:8px;"></div>

              <button id="diff-btn" onclick="toggleDiffView()" class="secondary-btn"
                style="display:none; font-size:0.75rem; padding:4px 8px;">ğŸ†š Diff View</button>

              <% if(suggestions) { %>
                <button onclick="copyToClipboard()" class="secondary-btn" style="font-size:0.75rem; padding:4px 8px;">ğŸ“‹
                  Copy</button>
                <% } %>
            </div>
          </div>

          <div class="ai-output" id="ai-output">
            <% if (error) { %>
              <div
                style="color: var(--error); padding: 20px; text-align: center; border: 1px solid var(--error); border-radius: 8px; background: rgba(239, 68, 68, 0.1);">
                <%= error %>
              </div>
              <% } else if (suggestions) { %>
                <!-- Render Suggestions -->
                <div class="markdown-content">
                  <!-- We'll assume the AI returns Markdown-like text. 
                       For now, we render it as text, but in a future step we should parse Markdown. 
                       Since the current server just sends text, we wrap it. -->
                  <pre><code class="language-<%= language ? language.toLowerCase() : 'plaintext' %>"><%= suggestions %></code></pre>
                </div>
                <% } else { %>
                  <!-- Empty State -->
                  <div class="empty-state">
                    <div class="empty-icon">ğŸ¤–</div>
                    <h3>Ready for your code</h3>
                    <p>Paste your snippet on the left and select a mode to begin.</p>
                  </div>
                  <% } %>
          </div>
        </section>

      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="/script.js"></script>
  <script>
    if (window.hljs) hljs.highlightAll();
  </script>
</body>

</html>